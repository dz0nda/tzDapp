{
  "contractName": "raffle",
  "abi": [],
  "michelson": "[ { \"prim\": \"parameter\",\n    \"args\":\n      [ { \"prim\": \"or\",\n          \"args\":\n            [ { \"prim\": \"or\",\n                \"args\":\n                  [ { \"prim\": \"unit\", \"annots\": [ \"%buyTicket\" ] },\n                    { \"prim\": \"nat\", \"annots\": [ \"%closeRaffle\" ] } ] },\n              { \"prim\": \"pair\",\n                \"args\":\n                  [ { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"mutez\" }, { \"prim\": \"timestamp\" } ] },\n                    { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"option\",\n                            \"args\": [ { \"prim\": \"string\" } ] },\n                          { \"prim\": \"bytes\" } ] } ],\n                \"annots\": [ \"%openRaffle\" ] } ] } ] },\n  { \"prim\": \"storage\",\n    \"args\":\n      [ { \"prim\": \"pair\",\n          \"args\":\n            [ { \"prim\": \"pair\",\n                \"args\":\n                  [ { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"pair\",\n                            \"args\":\n                              [ { \"prim\": \"address\", \"annots\": [ \"%admin\" ] },\n                                { \"prim\": \"timestamp\",\n                                  \"annots\": [ \"%close_date\" ] } ] },\n                          { \"prim\": \"pair\",\n                            \"args\":\n                              [ { \"prim\": \"string\",\n                                  \"annots\": [ \"%contract_name\" ] },\n                                { \"prim\": \"string\",\n                                  \"annots\": [ \"%description\" ] } ] } ] },\n                    { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"pair\",\n                            \"args\":\n                              [ { \"prim\": \"mutez\", \"annots\": [ \"%jackpot\" ] },\n                                { \"prim\": \"set\",\n                                  \"args\": [ { \"prim\": \"address\" } ],\n                                  \"annots\": [ \"%players\" ] } ] },\n                          { \"prim\": \"pair\",\n                            \"args\":\n                              [ { \"prim\": \"bool\",\n                                  \"annots\": [ \"%raffle_is_open\" ] },\n                                { \"prim\": \"big_map\",\n                                  \"args\":\n                                    [ { \"prim\": \"nat\" },\n                                      { \"prim\": \"address\" } ],\n                                  \"annots\": [ \"%sold_tickets\" ] } ] } ] } ] },\n              { \"prim\": \"bytes\",\n                \"annots\": [ \"%winning_ticket_number_hash\" ] } ] } ] },\n  { \"prim\": \"code\",\n    \"args\":\n      [ [ { \"prim\": \"UNPAIR\" },\n          { \"prim\": \"IF_LEFT\",\n            \"args\":\n              [ [ { \"prim\": \"IF_LEFT\",\n                    \"args\":\n                      [ [ { \"prim\": \"DROP\" }, { \"prim\": \"DUP\" },\n                          { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                          { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" },\n                          { \"prim\": \"IF\",\n                            \"args\":\n                              [ [ { \"prim\": \"SENDER\" },\n                                  { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"mutez\" },\n                                        { \"int\": \"1000000\" } ] },\n                                  { \"prim\": \"AMOUNT\" },\n                                  { \"prim\": \"COMPARE\" }, { \"prim\": \"NEQ\" },\n                                  { \"prim\": \"IF\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"DROP\" },\n                                          { \"prim\": \"PUSH\",\n                                            \"args\":\n                                              [ { \"prim\": \"string\" },\n                                                { \"string\":\n                                                    \"The sender does not own enough tz to buy a ticket.\" } ] },\n                                          { \"prim\": \"FAILWITH\" } ],\n                                        [ { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"MEM\" },\n                                          { \"prim\": \"IF\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"string\" },\n                                                        { \"string\":\n                                                            \"Each player can participate only once.\" } ] },\n                                                  { \"prim\": \"FAILWITH\" } ],\n                                                [ { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"bool\" },\n                                                        { \"prim\": \"True\" } ] },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"UPDATE\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"5\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"SOME\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"SIZE\" },\n                                                  { \"prim\": \"UPDATE\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" } ] ] } ] ] } ],\n                                [ { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"string\" },\n                                        { \"string\": \"The raffle is closed.\" } ] },\n                                  { \"prim\": \"FAILWITH\" } ] ] },\n                          { \"prim\": \"NIL\",\n                            \"args\": [ { \"prim\": \"operation\" } ] },\n                          { \"prim\": \"PAIR\" } ],\n                        [ { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                          { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                          { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                          { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                          { \"prim\": \"SOURCE\" }, { \"prim\": \"COMPARE\" },\n                          { \"prim\": \"NEQ\" },\n                          { \"prim\": \"IF\",\n                            \"args\":\n                              [ [ { \"prim\": \"DROP\" },\n                                  { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"string\" },\n                                        { \"string\":\n                                            \"administrator not recognized.\" } ] },\n                                  { \"prim\": \"FAILWITH\" } ],\n                                [ { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"IF\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"PACK\" },\n                                          { \"prim\": \"SHA256\" },\n                                          { \"prim\": \"COMPARE\" },\n                                          { \"prim\": \"NEQ\" },\n                                          { \"prim\": \"IF\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"string\" },\n                                                        { \"string\":\n                                                            \"the hash does not match the hash of the winning ticket.\" } ] },\n                                                  { \"prim\": \"FAILWITH\" } ],\n                                                [ { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"SIZE\" },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"EDIV\" },\n                                                  { \"prim\": \"IF_NONE\",\n                                                    \"args\":\n                                                      [ [ { \"prim\": \"PUSH\",\n                                                            \"args\":\n                                                              [ { \"prim\":\n                                                                    \"string\" },\n                                                                { \"string\":\n                                                                    \"MOD by 0\" } ] },\n                                                          { \"prim\":\n                                                              \"FAILWITH\" } ],\n                                                        [] ] },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"GET\" },\n                                                  { \"prim\": \"IF_NONE\",\n                                                    \"args\":\n                                                      [ [ { \"prim\": \"PUSH\",\n                                                            \"args\":\n                                                              [ { \"prim\":\n                                                                    \"string\" },\n                                                                { \"string\":\n                                                                    \"winner address not found\" } ] },\n                                                          { \"prim\":\n                                                              \"FAILWITH\" } ],\n                                                        [] ] },\n                                                  { \"prim\": \"CONTRACT\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"unit\" } ] },\n                                                  { \"prim\": \"IF_NONE\",\n                                                    \"args\":\n                                                      [ [ { \"prim\": \"PUSH\",\n                                                            \"args\":\n                                                              [ { \"prim\":\n                                                                    \"string\" },\n                                                                { \"string\":\n                                                                    \"winner contract not found.\" } ] },\n                                                          { \"prim\":\n                                                              \"FAILWITH\" } ],\n                                                        [] ] },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"UNIT\" },\n                                                  { \"prim\": \"TRANSFER_TOKENS\" },\n                                                  { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"mutez\" },\n                                                        { \"int\": \"0\" } ] },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"timestamp\" },\n                                                        { \"int\": \"0\" } ] },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"string\" },\n                                                        { \"string\":\n                                                            \"raffle is currently closed\" } ] },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"bool\" },\n                                                        { \"prim\": \"False\" } ] },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"EMPTY_SET\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"address\" } ] },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"EMPTY_BIG_MAP\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"nat\" },\n                                                        { \"prim\": \"address\" } ] },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" } ] ] } ],\n                                        [ { \"prim\": \"DROP\" },\n                                          { \"prim\": \"PUSH\",\n                                            \"args\":\n                                              [ { \"prim\": \"string\" },\n                                                { \"string\":\n                                                    \"The raffle is closed.\" } ] },\n                                          { \"prim\": \"FAILWITH\" } ] ] } ] ] },\n                          { \"prim\": \"NIL\",\n                            \"args\": [ { \"prim\": \"operation\" } ] },\n                          { \"prim\": \"PAIR\" } ] ] } ],\n                [ { \"prim\": \"DUP\" },\n                  { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"CDR\" }, { \"prim\": \"CDR\" },\n                  { \"prim\": \"DUP\", \"args\": [ { \"int\": \"3\" } ] },\n                  { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" }, { \"prim\": \"PAIR\" },\n                  { \"prim\": \"DUP\", \"args\": [ { \"int\": \"3\" } ] },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                  { \"prim\": \"DIG\", \"args\": [ { \"int\": \"3\" } ] },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                  { \"prim\": \"DIG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"UNPAIR\" },\n                  { \"prim\": \"DUP\", \"args\": [ { \"int\": \"5\" } ] },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"SOURCE\" },\n                  { \"prim\": \"COMPARE\" }, { \"prim\": \"NEQ\" },\n                  { \"prim\": \"IF\",\n                    \"args\":\n                      [ [ { \"prim\": \"DROP\", \"args\": [ { \"int\": \"4\" } ] },\n                          { \"prim\": \"PUSH\",\n                            \"args\":\n                              [ { \"prim\": \"string\" },\n                                { \"string\": \"Administrator not recognized.\" } ] },\n                          { \"prim\": \"FAILWITH\" } ],\n                        [ { \"prim\": \"DUP\", \"args\": [ { \"int\": \"5\" } ] },\n                          { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                          { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" },\n                          { \"prim\": \"NOT\" },\n                          { \"prim\": \"IF\",\n                            \"args\":\n                              [ [ { \"prim\": \"DUP\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"AMOUNT\" },\n                                  { \"prim\": \"COMPARE\" }, { \"prim\": \"LT\" },\n                                  { \"prim\": \"IF\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"DROP\",\n                                            \"args\": [ { \"int\": \"4\" } ] },\n                                          { \"prim\": \"PUSH\",\n                                            \"args\":\n                                              [ { \"prim\": \"string\" },\n                                                { \"string\":\n                                                    \"The administrator does not own enough tz.\" } ] },\n                                          { \"prim\": \"FAILWITH\" } ],\n                                        [ { \"prim\": \"NOW\" },\n                                          { \"prim\": \"PUSH\",\n                                            \"args\":\n                                              [ { \"prim\": \"int\" },\n                                                { \"int\": \"86400\" } ] },\n                                          { \"prim\": \"PUSH\",\n                                            \"args\":\n                                              [ { \"prim\": \"int\" },\n                                                { \"int\": \"7\" } ] },\n                                          { \"prim\": \"MUL\" },\n                                          { \"prim\": \"ADD\" },\n                                          { \"prim\": \"DUP\",\n                                            \"args\": [ { \"int\": \"5\" } ] },\n                                          { \"prim\": \"COMPARE\" },\n                                          { \"prim\": \"LT\" },\n                                          { \"prim\": \"IF\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"DROP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"string\" },\n                                                        { \"string\":\n                                                            \"The raffle must remain open for at least 7 days.\" } ] },\n                                                  { \"prim\": \"FAILWITH\" } ],\n                                                [ { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"5\" } ] },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"6\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"7\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"5\" } ] },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"5\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"6\" } ] },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"bool\" },\n                                                        { \"prim\": \"True\" } ] },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"IF_NONE\",\n                                                    \"args\":\n                                                      [ [],\n                                                        [ { \"prim\": \"SWAP\" },\n                                                          { \"prim\": \"DUP\" },\n                                                          { \"prim\": \"DUG\",\n                                                            \"args\":\n                                                              [ { \"int\": \"2\" } ] },\n                                                          { \"prim\": \"CDR\" },\n                                                          { \"prim\": \"DUP\",\n                                                            \"args\":\n                                                              [ { \"int\": \"3\" } ] },\n                                                          { \"prim\": \"CAR\" },\n                                                          { \"prim\": \"CDR\" },\n                                                          { \"prim\": \"DIG\",\n                                                            \"args\":\n                                                              [ { \"int\": \"2\" } ] },\n                                                          { \"prim\": \"DUP\",\n                                                            \"args\":\n                                                              [ { \"int\": \"4\" } ] },\n                                                          { \"prim\": \"CAR\" },\n                                                          { \"prim\": \"CAR\" },\n                                                          { \"prim\": \"CDR\" },\n                                                          { \"prim\": \"CAR\" },\n                                                          { \"prim\": \"PAIR\" },\n                                                          { \"prim\": \"DIG\",\n                                                            \"args\":\n                                                              [ { \"int\": \"3\" } ] },\n                                                          { \"prim\": \"CAR\" },\n                                                          { \"prim\": \"CAR\" },\n                                                          { \"prim\": \"CAR\" },\n                                                          { \"prim\": \"PAIR\" },\n                                                          { \"prim\": \"PAIR\" },\n                                                          { \"prim\": \"PAIR\" } ] ] } ] ] } ] ] } ],\n                                [ { \"prim\": \"DROP\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"string\" },\n                                        { \"string\":\n                                            \"A raffle is already open.\" } ] },\n                                  { \"prim\": \"FAILWITH\" } ] ] } ] ] },\n                  { \"prim\": \"NIL\", \"args\": [ { \"prim\": \"operation\" } ] },\n                  { \"prim\": \"PAIR\" } ] ] } ] ] } ]",
  "source": "type openRaffleParameter is tez * timestamp * option(string) * bytes\ntype buyTicketParameter is unit\ntype closeRaffleParameter is nat\n\ntype raffleEntrypoints is\n  OpenRaffle of openRaffleParameter\n| BuyTicket of buyTicketParameter\n| CloseRaffle of closeRaffleParameter\n\n\ntype storage is record [\n    contract_name: string;\n    admin : address;\n    close_date : timestamp;\n    jackpot : tez;\n    description : string;\n    players : set (address);\n    sold_tickets : big_map (nat, address);\n    raffle_is_open : bool;\n    winning_ticket_number_hash : bytes;\n  ]\n\ntype returnType is list (operation) * storage\n\nfunction open_raffle (const jackpot_amount : tez; const close_date : timestamp; const description : option (string); const winning_ticket_number_hash : bytes; var store : storage) : returnType is\n  block {\n    if Tezos.source =/= store.admin then failwith(\"Administrator not recognized.\")\n    else {\n      if not store.raffle_is_open then {\n        if Tezos.amount < jackpot_amount then failwith(\"The administrator does not own enough tz.\")\n        else{\n        const today : timestamp = Tezos.now;\n        const seven_day : int = 7 * 86400;\n        const in_7_day : timestamp = today + seven_day;\n        const is_close_date_not_valid : bool = close_date < in_7_day;\n        if is_close_date_not_valid then failwith(\"The raffle must remain open for at least 7 days.\")\n        else {\n          patch store with record [\n          jackpot = jackpot_amount;\n          close_date = close_date;\n          raffle_is_open = True;\n          winning_ticket_number_hash = winning_ticket_number_hash;\n          ];\n\n          case description of\n            Some(d) -> patch store with record [description=d]\n          | None -> {skip}\n          end\n        }\n      }\n    } else {\n        failwith(\"A raffle is already open.\")\n    }\n  }\n} with ((nil : list (operation)), store)\n\n\nfunction buy_ticket (const _param: unit; var store : storage) : returnType is\n  block {\n    if store.raffle_is_open then {\n      const ticket_price : tez = 1tez;\n      const current_player : address = Tezos.sender;\n      if Tezos.amount =/= ticket_price then failwith(\"The sender does not own enough tz to buy a ticket.\")\n      else {\n        if store.players contains current_player then failwith(\"Each player can participate only once.\")\n        else {\n          const ticket_id : nat = Set.size(store.players);\n          store.players := Set.add(current_player, store.players);\n            // store.sold_tickets[ticket_id] := current_player;\n          store.sold_tickets := Big_map.update(ticket_id, Some(current_player), store.sold_tickets);\n        }\n      }\n    } else {\n      failwith(\"The raffle is closed.\")\n    }\n  } with ((nil : list (operation)), store)\n\nfunction close_raffle (const winning_ticket_number : nat; var store : storage) : returnType is\n  block {\n    const operations : list(operation) = nil;\n    if Tezos.source =/= store.admin then failwith(\"administrator not recognized.\")\n    else {\n      if store.raffle_is_open then {\n        const winning_ticket_number_bytes : bytes = Bytes.pack(winning_ticket_number);\n        const winning_ticket_number_hash : bytes = Crypto.sha256(winning_ticket_number_bytes);\n        if winning_ticket_number_hash =/= store.winning_ticket_number_hash then failwith(\"the hash does not match the hash of the winning ticket.\")\n        else{\n          const number_of_players : nat = Set.size(store.players);\n          const winning_ticket_id : nat = winning_ticket_number mod number_of_players;\n          const winner : address =\n          case (store.sold_tickets[winning_ticket_id]) of\n            Some (a) -> a\n          | None -> (failwith (\"winner address not found\") : address)\n          end;\n\n          const receiver : contract (unit) =\n          case (Tezos.get_contract_opt (winner) : option (contract (unit))) of\n            Some (c) -> c\n          | None -> (failwith (\"winner contract not found.\") : contract (unit))\n          end;\n\n          const op : operation = Tezos.transaction(unit, store.jackpot, receiver);\n          const _operations : list(operation) = list [ op; ];\n\n          patch store with record [\n          jackpot = 0tez;\n          close_date = (0 : timestamp);\n          description = (\"raffle is currently closed\" : string);\n          raffle_is_open = False;\n          players = (set[] : set(address));\n          sold_tickets = (big_map[] : big_map (nat, address));\n          ];\n        }\n      } else {\n        failwith(\"The raffle is closed.\")\n      }\n    }\n  } with (operations, store)\n\nfunction main (const action : raffleEntrypoints; const store : storage): returnType is\nblock {\n    const return : returnType = case action of\n      OpenRaffle (param) -> open_raffle (param.0, param.1, param.2, param.3, store)\n    | BuyTicket (param) -> buy_ticket(param, store)\n    | CloseRaffle (param) -> close_raffle (param, store)\n    end;\n } with return",
  "sourcePath": "/Users/dzonda/Dev/tzDapp/tezos/contracts/raffle.ligo",
  "compiler": {
    "name": "ligo",
    "version": "next"
  },
  "networks": {
    "NetXz969SFaFn8k": {
      "events": {},
      "links": {},
      "address": "KT1Dz2Q2rtxNxfKNmeSdajeikM4gU5oTSh8B",
      "transactionHash": "op3rZsq6RnvhAhWYwFu6NDXqwM2W4Hi3rt7ba7kF3Jp7T4dHYTp"
    }
  },
  "schemaVersion": "3.2.0-tezos.1",
  "updatedAt": "2021-08-28T18:20:05.698Z",
  "networkType": "tezos"
}